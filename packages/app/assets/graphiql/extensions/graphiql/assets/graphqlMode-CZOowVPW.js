const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["extensions/graphiql/assets/monaco-editor-DHweyzAq.js","extensions/graphiql/assets/index-DurqXJRt.js","extensions/graphiql/assets/index-DB2qidwj.css","extensions/graphiql/assets/mouseTarget-BLbOaqWL.js","extensions/graphiql/assets/monaco-editor-CjcUWNYt.css"])))=>i.map(i=>d[i]);
var M=Object.defineProperty;var T=(t,e,r)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>T(t,typeof e!="symbol"?e+"":e,r);import{e as u,U as x,l as _}from"./monaco-editor-DHweyzAq.js";import{a as F,b as w,_ as b,C as s}from"./index-DurqXJRt.js";import"./mouseTarget-BLbOaqWL.js";const E=120*1e3;class O{constructor(e){d(this,"_defaults");d(this,"_idleCheckInterval");d(this,"_lastUsedTime",0);d(this,"_configChangeListener");d(this,"_worker",null);d(this,"_client",null);this._defaults=e,this._idleCheckInterval=window.setInterval(()=>this._checkIfIdle(),30*1e3),this._configChangeListener=this._defaults.onDidChange(()=>{this._stopWorker()})}_stopWorker(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null}dispose(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._stopWorker()}_checkIfIdle(){if(!this._worker)return;Date.now()-this._lastUsedTime>E&&this._stopWorker()}async _getClient(){if(this._lastUsedTime=Date.now(),!this._client&&!this._worker)try{const{languageId:e,formattingOptions:r,schemas:a,externalFragmentDefinitions:c,completionSettings:l}=this._defaults;this._worker=u.createWebWorker({moduleId:"monaco-graphql/esm/GraphQLWorker.js",label:e,createData:{languageId:e,formattingOptions:r,languageConfig:{schemas:a==null?void 0:a.map(F),externalFragmentDefinitions:c,fillLeafsOnComplete:l.__experimental__fillLeafsOnComplete}}}),this._client=this._worker.getProxy()}catch(e){console.error("error loading worker",e)}return this._client}async getLanguageServiceWorker(...e){const r=await this._getClient();return await this._worker.withSyncedResources(e),r}}class L{constructor(e,r){d(this,"defaults");d(this,"_worker");d(this,"_disposables",[]);d(this,"_listener",Object.create(null));this.defaults=e,this._worker=r,this._worker=r;let a;const c=o=>{var p;const g=w(o);if(g!==this.defaults.languageId)return;const h=o.uri.toString(),m=(p=e.diagnosticSettings.validateVariablesJSON)==null?void 0:p[h];a=setTimeout(()=>{this._doValidate(o.uri,g,m)},400),this._listener[h]=o.onDidChangeContent(()=>{clearTimeout(a),a=setTimeout(()=>{this._doValidate(o.uri,g,m)},400)})},l=o=>{u.setModelMarkers(o,this.defaults.languageId,[]);const g=o.uri.toString(),h=this._listener[g];h&&(h.dispose(),delete this._listener[g])};this._disposables.push(u.onDidCreateModel(c),{dispose(){clearTimeout(a)}},u.onWillDisposeModel(o=>{l(o)}),u.onDidChangeModelLanguage(o=>{l(o.model),c(o.model)}),{dispose:()=>{for(const o of Object.values(this._listener))o.dispose()}},e.onDidChange(()=>{for(const o of u.getModels())w(o)===this.defaults.languageId&&(l(o),c(o))}));for(const o of u.getModels())w(o)===this.defaults.languageId&&c(o)}dispose(){for(const e of this._disposables)e.dispose();this._disposables=[]}async _doValidate(e,r,a){var o;const c=await this._worker(e);if(!c)return;const l=await c.doValidation(e.toString());if(u.setModelMarkers(u.getModel(e),r,l),a){if(await b(()=>import("./monaco-editor-DHweyzAq.js").then(f=>f.a),__vite__mapDeps([0,1,2,3,4])),!a.length)throw new Error("No variables URI strings provided to validate");const g=await c.doGetVariablesJSONSchema(e.toString());if(!g)return;const h=x.file(a[0].replace(".json","-schema.json")).toString(),m={uri:h,schema:g,fileMatch:a},p=((o=_.json.jsonDefaults.diagnosticsOptions.schemas)==null?void 0:o.filter(f=>f.uri!==h))||[];_.json.jsonDefaults.setDiagnosticsOptions({schemaValidation:"error",validate:!0,...this.defaults.diagnosticSettings.jsonDiagnosticSettings,schemas:[...p,m],enableSchemaRequest:!1})}}}const i=_.CompletionItemKind,I={[s.Text]:i.Text,[s.Method]:i.Method,[s.Function]:i.Function,[s.Constructor]:i.Constructor,[s.Field]:i.Field,[s.Variable]:i.Variable,[s.Class]:i.Class,[s.Interface]:i.Interface,[s.Module]:i.Module,[s.Property]:i.Property,[s.Unit]:i.Unit,[s.Value]:i.Value,[s.Enum]:i.Enum,[s.Keyword]:i.Keyword,[s.Snippet]:i.Snippet,[s.Color]:i.Color,[s.File]:i.File,[s.Reference]:i.Reference,[s.Folder]:i.Folder,[s.EnumMember]:i.EnumMember,[s.Constant]:i.Constant,[s.Struct]:i.Struct,[s.Event]:i.Event,[s.Operator]:i.Operator,[s.TypeParameter]:i.TypeParameter};function P(t){return t in I?I[t]:i.Text}function V(t){return{range:t.range,kind:P(t.kind),label:t.label,insertText:t.insertText??t.label,insertTextRules:t.insertText?_.CompletionItemInsertTextRule.InsertAsSnippet:void 0,sortText:t.sortText,filterText:t.filterText,documentation:t.documentation,detail:t.detail,command:t.command}}class j{constructor(e){d(this,"_worker");this._worker=e,this._worker=e}get triggerCharacters(){return[":","$"," ","(","@"]}async provideCompletionItems(e,r,a,c){try{return{incomplete:!0,suggestions:(await(await this._worker(e.uri)).doComplete(e.uri.toString(),r)).map(V)}}catch(l){return console.error("Error fetching completion items",l),{suggestions:[]}}}}class D{constructor(e){d(this,"_worker");this._worker=e,this._worker=e}async provideDocumentFormattingEdits(e,r,a){const l=await(await this._worker(e.uri)).doFormat(e.uri.toString());return l?[{range:e.getFullModelRange(),text:l}]:[]}}class R{constructor(e){d(this,"_worker");this._worker=e}async provideHover(e,r,a){const c=e.uri,o=await(await this._worker(e.uri)).doHover(c.toString(),r);return o?{range:o.range,contents:[{value:o.content}]}:{contents:[]}}dispose(){}}function K(t){const e=[],r=[],a=new O(t);e.push(a);const c=(...n)=>{try{return a.getLanguageServiceWorker(...n)}catch{throw new Error("Error fetching graphql language service worker")}};function l(){const{modeConfiguration:n,languageId:k}=t;n.documentFormattingEdits&&r.push(_.registerDocumentFormattingEditProvider(k,new D(c)))}function o(n){const{modeConfiguration:k,languageId:C}=t;v(r),k.completionItems&&r.push(_.registerCompletionItemProvider(C,new j(c))),k.diagnostics&&r.push(new L(n,c)),k.hovers&&r.push(_.registerHoverProvider(C,new R(c))),l()}let{modeConfiguration:g,formattingOptions:h,diagnosticSettings:m,externalFragmentDefinitions:p,schemas:f}=t;return o(t),t.onDidChange(n=>{n.modeConfiguration!==g&&(g=n.modeConfiguration,o(n)),n.formattingOptions!==h&&(h=n.formattingOptions,l()),n.externalFragmentDefinitions!==p&&(p=n.externalFragmentDefinitions,o(n)),n.diagnosticSettings!==m&&(m=n.diagnosticSettings,o(n)),n.schemas!==f&&(f=n.schemas,o(n))}),e.push(S(r)),S(e)}function S(t){return{dispose:()=>v(t)}}function v(t){for(;t.length;)t.pop().dispose()}export{K as setupMode};
